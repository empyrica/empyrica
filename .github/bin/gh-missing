#!/bin/sh
set -eu

print_help() {
    cat <<EOF
gh-missing - List packages missing a GitHub repository

Usage:
  .github/bin/pkg-list | .github/bin/gh-missing

Options:
  -h, --help    Show this help message and exit
EOF
}

case "${1:-}" in
    -h|--help) print_help; exit 0 ;;
esac

# --- Main loop: read `.github/bin/pkg-list` output ---
while IFS= read -r LINE; do
    STATUS=$(curl -s -o /dev/null -w "%{http_code}" -I "https://github.com/$LINE")
    if [ "$STATUS" -ne 200 ]; then
        echo "$LINE"
    fi
done
